<!DOCTYPE html>
<html><head><meta name="GCD" content="YTk3ODQ3ZWZhN2I4NzZmMzBkNTEwYjJl98945a03e22693f5f6e8812a1f31589d"/>
  <meta charset="utf-8">
  <title>Weather</title>
  <meta name="generator" content="Google Web Designer 5.0.4.0226">
  <style type="text/css" id="gwd-text-style">.sidenav {
    height: 100%;
    width: 130px;
    position: fixed;
    z-index: 1;
    top: 0px;
    left: 0px;
    background-color: rgb(80, 0, 80);
    overflow-x: hidden;
    padding-top: 40px;
}
.sidenav a {
    padding: 5px 5px 5px 32px;
    text-decoration: none;
    font-size: 25px;
    color: rgb(192, 192, 192);
    display: block;
}
.sidenav a:hover {
    color: rgb(241, 241, 241);
}
.data {
    position: absolute;
    margin: auto;
    text-align: center;
    overflow: auto;
    top: 0px;
    height: 750px;
    width: 100%;
}
.about {
    top: 0px;
    text-align: left;
    position: absolute;
    margin-left: 430px;
    width: 1100px;
}
.graph {
    top: 0px;
    text-align: left;
    position: absolute;
    margin-left: 130px;
    width: 1100px;
}
.cent {
    text-align: left;
    position: relative;
    margin: auto;
    width: 1160px;
}
.cent_c {
    text-align: left;
    position: relative;
    margin: auto;
    width: 1000px;
}
.column {
    float: left;
    height: 680px;
    width: 370px;
    text-align: center;
}
.column_1 {
    width: 780px;
    height: 680px;
    float: right;
    text-align: center;
}
.row {
    height: 170px;
    content: "";
    clear: both;
}
@media (max-height: 450px) {
    .sidenav {
        padding-top: 10px;
    }
    .sidenav a {
        font-size: 18px;
    }
}</style>
  <style type="text/css">html,
body {
    width: 100%;
    height: 100%;
    margin: 0px;
}
body {
    background-color: transparent;
    transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1);
    -webkit-transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1);
    -moz-transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1);
    perspective: 1400px;
    -webkit-perspective: 1400px;
    -moz-perspective: 1400px;
    transform-style: preserve-3d;
    -webkit-transform-style: preserve-3d;
    -moz-transform-style: preserve-3d;
}</style>
  <script type="text/javascript">
    var sel;
    var sort_update;

    function handleSelect() {
      sel = document.getElementById("duration").value;
      //WaitDownload();
      active_window = 1;
      sort_update();
    }

    window.onload = function() {

      var L1 = 130;
      var L2 = 350;
      var L3 = 570;
      var xhr;
      var H_offset = 0;
      var active_window = 1;
      var p_col = "#5050f8";
      var peak_col = "#ff0000";
      var col1 = "#cc1c5e";
      var col2 = "#e730e7";
      var col3 = "#2c57eb";
      var col4 = "#39dddd";
      var r_col = "#8cc8e8";
      var PI = 3.1416;
      var rad = 57.2958;
      var rain_scale = 137;
      var marker = 0;
      var mark = true;
      var c = document.getElementById("canvas");
      var dia = 80;
      var dia_small = 70;
      var myMsg;
      var m_len = 30;
      var len = 30;
      var chart = [document.getElementById('canvas_a').getContext('2d'),
        document.getElementById('canvas_b').getContext('2d'),
        document.getElementById('canvas_c').getContext('2d'),
        document.getElementById('canvas_d').getContext('2d'),
        document.getElementById('canvas_e').getContext('2d')
      ];
      var titles = ['Temperature', '', ' Humidity  ', '', ' Pressure  ', ' Wind Speed ', '', ' Rain Fall '];
      var plot = ['Out High', 'In High', 'Out High', 'In High', 'High', 'Gust', 'Mean', 'Total', 'Out Low', 'In Low', 'Out Low', 'In Low', 'Low'];
      var axis_x_label = ['Minutes', 'Hours', 'January', 'Febuary', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
      var axis_y_label = ['C', '', '%', '', 'mB', 'mph', '', 'mm'];
      var myarr;
      var m_m_arr;
      document.getElementById("canvas_b").addEventListener("click", canvas_b_click);
      document.getElementById("canvas_c").addEventListener("click", canvas_c_click);
      document.getElementById("canvas_d").addEventListener("click", canvas_d_click);
      document.getElementById("canvas_e").addEventListener("click", canvas_e_click);

      // Start Current Page
      function draw_dial(loc, win) {
        var x1, y1;
        var ident;
        var scale = 5,
          start = -20;
        var text = "";
        win.textAlign = "center";
        win.fillStyle = "Black";
        win.font = "14px Arial";
        switch (loc) {
          case 0:
            x1 = 166;
            y1 = L1;
            ident = 13;
            scale = 5;
            start = -20;
            text = "Inside Temperature ( C )";
            break;
          case 1:
            x1 = 832;
            y1 = L1;
            ident = 13;
            scale = 5;
            start = -20;
            text = "Outside Temperature ( C )";
            break;
          case 2:
            x1 = 166;
            y1 = L2;
            ident = 11;
            scale = 10;
            start = 0;
            text = "Inside Humidity ( % )";
            break;
          case 3:
            x1 = 832;
            y1 = L2;
            ident = 11;
            scale = 10;
            start = 0;
            text = "Outside Humidity ( % )";
            break;
          case 4:
            x1 = 500;
            y1 = L1;
            ident = 11;
            scale = 20;
            start = 860;
            text = "Air Pressure ( mb )";
            break;
          case 5:
            x1 = 166;
            y1 = L3;
            ident = 11;
            scale = 5;
            start = 0;
            text = "Wind Speed ( mph )";
            break;
        }
        var step = 240 / (ident - 1);
        var offset = dia * 0.707;
        win.beginPath();
        win.arc(x1, y1, dia, 0.75 * PI, 0.25 * PI);
        win.stroke();
        win.beginPath();
        win.moveTo(x1 - offset, y1 + offset);
        win.lineTo(x1 + offset, y1 + offset);
        win.stroke();
        var val;
        for (var i = 0; i < ident; i++) {
          var x2, y2, x3, y3;
          var ang = (-30 + (step * i)) / rad;
          y2 = y1 - ((dia + 2) * Math.sin(ang));
          y3 = y1 - ((dia + 10) * Math.sin(ang));
          x2 = x1 - ((dia + 2) * Math.cos(ang));
          x3 = x1 - ((dia + 10) * Math.cos(ang));
          win.beginPath();
          win.moveTo(x2, y2);
          win.lineTo(x3, y3);
          win.stroke();
          val = (i * scale) + start;
          y2 = y1 + 5 - ((dia + 25) * Math.sin(ang));
          x2 = x1 - ((dia + 25) * Math.cos(ang));
          win.fillText(val.toString(), x2, y2);
        }
        win.fillText(text, x1, y1 + 80);
      }


      function draw_bearing(win) {
        var x = 833;
        var y = L3 - 20;
        var ident = 8;
        var direction = ["N", "NE", "E", "SE", "S", "SW", "W", "NW"];
        win.beginPath();
        win.arc(x, y, dia_small, 0, 2 * PI);
        win.stroke();
        win.beginPath();
        win.textAlign = "center";
        win.fillStyle = "Black";
        win.font = "14px Arial";
        var step = 360 / ident;
        for (var i = 0; i < ident; i++) {
          var x2, y2, x3, y3;
          var ang = (90 + (step * i)) / rad;
          y2 = y - ((dia_small + 2) * Math.sin(ang));
          y3 = y - ((dia_small + 10) * Math.sin(ang));
          x2 = ((dia_small + 2) * Math.cos(ang)) + x;
          x3 = ((dia_small + 10) * Math.cos(ang)) + x;
          win.beginPath();
          win.moveTo(x2, y2);
          win.lineTo(x3, y3);
          win.stroke();

          val = (i * 30);
          y2 = y + 5 - ((dia_small + 25) * Math.sin(ang));
          x2 = x - ((dia_small + 25) * Math.cos(ang));
          win.fillText(direction[i], x2, y2);
        }

        text = "Wind Bearing ( mph )";
        win.fillText(text, x, y + 120);
      }

      function data_plot(x, y, win) {
        var delta;
        var dia1 = 80;
        var x1, y1;
        var peak = false;
        switch (x) {
          case 0:
            delta = (1.1667 - (((20 + y) / 90) * 2)) * PI;
            x1 = 166;
            y1 = L1;
            break;
          case 1:
            delta = (1.1667 - (((20 + y) / 90) * 2)) * PI;
            x1 = 832;
            y1 = L1;
            break;
          case 2:
            delta = (1.1667 - ((y / 150) * 2)) * PI;
            x1 = 166;
            y1 = L2;
            break;
          case 3:
            delta = (1.1667 - ((y / 150) * 2)) * PI;
            x1 = 832;
            y1 = L2;
            break;
          case 4:
            delta = (1.1667 - (((y - 860) / 300) * 2)) * PI;
            x1 = 500;
            y1 = L1;
            break;
          case 5:
            delta = (1.1667 - ((y / 75) * 2)) * PI;
            x1 = 166;
            y1 = L3;
            break;
          case 6:
            delta = (0.5 - ((y / 360) * 2)) * PI;
            x1 = 832;
            y1 = L3 - 20;
            dia1 = 70;
            break;
          case 7:
            delta = (1.1667 - ((y / 75) * 2)) * PI;
            x1 = 166;
            y1 = L3;
            peak = true;
            break;
        }
        var x2, y2, x3, y3, x4, y4;
        if (peak) {
          y2 = y1 - ((dia1 - 15) * Math.sin(delta + 0.075));
          y3 = y1 - (dia1 * Math.sin(delta));
          y4 = y1 - ((dia1 - 15) * Math.sin(delta - 0.075));
          x2 = ((dia1 - 15) * Math.cos(delta + 0.075)) + x1;
          x3 = (dia1 * Math.cos(delta)) + x1;
          x4 = ((dia1 - 15) * Math.cos(delta - 0.075)) + x1;

          win.beginPath();
          win.fillStyle = peak_col;
          win.moveTo(x2, y2);
          win.lineTo(x3, y3);
          win.lineTo(x4, y4);
          win.lineTo(x2, y2);
          win.fill();

          win.font = "16px Arial";
          win.fillText(y, x1, y1 + 20);


        } else {

          y2 = y1 - ((dia1 - 15) * Math.sin(delta + 0.075));
          y3 = y1 - (dia1 * Math.sin(delta));
          y4 = y1 - ((dia1 - 15) * Math.sin(delta - 0.075));
          x2 = ((dia1 - 15) * Math.cos(delta + 0.075)) + x1;
          x3 = (dia1 * Math.cos(delta)) + x1;
          x4 = ((dia1 - 15) * Math.cos(delta - 0.075)) + x1;

          win.beginPath();
          win.fillStyle = p_col;
          win.moveTo(x2, y2);
          win.lineTo(x3, y3);
          win.lineTo(x4, y4);
          win.lineTo(x2, y2);
          win.fill();
          win.font = "16px Arial";
          if (x != 6) win.fillText(y, x1, y1);
        }

        win.font = "14px Arial";
      }

      function draw_rain(win) {
        win.rect(449, 250, 52, 152);
        win.rect(501, 250, 52, 152);
        win.stroke();
        win.beginPath();
        win.textAlign = "center";
        win.fillStyle = "Black";
        win.font = "14px Arial";
        win.fillText("rate", 370, 310);
        win.fillText(" of ", 370, 325);
        win.fillText("fall", 370, 340);
        win.fillText("/hr", 370, 355);
        win.fillText("total", 620, 320);
        win.fillText("this", 620, 335);
        win.fillText(" hr ", 620, 350);
        win.fillText("Rain Fall ( mm )", 500, L2 + 80);
      }

      function rain_plot(now, total, win) {
        now /= (rain_scale / 60);
        total /= rain_scale;
        var n_scale = Math.ceil(now + 0.5);
        var t_scale = Math.ceil(total + 0.5);
        var n_ticks = Math.ceil(n_scale / 5);
        var ticks = 152 / 5;
        var s = 0;
        var num = s.toFixed(1);
        var y = 402;
        var count = 5;
        do {
          win.fillStyle = "black";
          win.beginPath();
          win.moveTo(444, y);
          win.lineTo(449, y);
          win.stroke();
          win.fillText(num, 415, y + 5);
          y -= ticks;
          s += n_ticks;
          num = s.toFixed(1);
          count--;
        } while (count >= 0);

        s -= n_ticks;
        num = s.toFixed(1);
        var n_s = 152 * (now / num);
        var t_ticks = Math.ceil(t_scale / 5);
        ticks = 152 / 5;
        s = 0;
        num = s.toFixed(1);
        var y = 402;
        count = 5;
        do {
          win.beginPath();
          win.moveTo(553, y);
          win.lineTo(558, y);
          win.stroke();
          win.fillText(num, 580, y + 5);
          y -= ticks;
          s += t_ticks;
          num = s.toFixed(1);
          count--;
        } while (count >= 0);
        s -= t_ticks;
        num = s.toFixed(1);

        var n_t = 152 * (total / num);
        win.beginPath();
        win.fillStyle = r_col;
        win.rect(450, 402 - n_s, 50, n_s);
        win.fill();
        win.beginPath();
        win.fillStyle = "Blue";
        win.rect(502, 402 - n_t, 50, n_t);
        win.fill();
      }

      function drawHand(win, pos, length, width) {
        win.beginPath();
        win.lineWidth = width;
        win.lineCap = "round";
        win.moveTo(500, L3);
        var x = Math.sin(pos / rad) * length;
        var y = Math.cos(pos / rad) * length;
        win.lineTo(500 + x, L3 - y);
        win.stroke();
      }

      function clock(win) {
        var step = 30;
        var cc = L3;
        win.beginPath();
        win.arc(500, cc, dia, 0, 2 * PI);
        win.stroke();
        for (var i = 1; i <= 12; i++) {
          var x2, y2, x3, y3;
          var ang = (90 + (step * i)) / rad;
          y2 = cc - ((dia) * Math.sin(ang));
          y3 = cc - ((dia - 5) * Math.sin(ang));
          x2 = ((dia) * Math.cos(ang)) + 500;
          x3 = ((dia - 5) * Math.cos(ang)) + 500;
          win.beginPath();
          win.moveTo(x2, y2);
          win.lineTo(x3, y3);
          win.stroke();
          val = (i * 30);
          y2 = cc + 5 - ((dia + 10) * Math.sin(ang));
          x2 = 500 - ((dia + 10) * Math.cos(ang));
          win.fillText(i, x2, y2);
        }
        var d, h, m;
        d = new Date();
        h = d.getHours();
        m = d.getMinutes();
        h = h % 12;
        //hour
        h = ((h / 12) * 360) + ((m / 60) * 30);
        drawHand(win, h, dia * 0.5, 4);
        //minute
        m = (m / 60) * 360;
        drawHand(win, m, dia * 0.8, 2);
        win.lineWidth = 1;
      }

      function update_fields() {
        xhr = new XMLHttpRequest();
        var a = '0';
        var url = "https://script.google.com/macros/s/AKfycbz8j9Kdwk7cLgs_HA_j0kPHvAvU_OL3f9zPfY4aoeh0vn5Jr17b/exec?read=current";
        xhr.onreadystatechange = function() {
          if (xhr.readyState == 4) {
            var t_r = xhr.responseText;
            var dat = t_r.split(",");
            var x = document.getElementById("cent_c");
            x.style.display = "block";
            x = document.getElementById("canvas_area_1");
            x.style.display = "none";
            x = document.getElementById("about");
            x.style.display = "none";
            var ctx = c.getContext("2d");
            ctx.fillStyle = "white";
            ctx.fillRect(0, 0, 1000, 750);
            draw_dial(0, ctx);
            draw_dial(1, ctx);
            draw_dial(2, ctx);
            draw_dial(3, ctx);
            draw_dial(4, ctx);
            draw_dial(5, ctx);
            draw_bearing(ctx);
            draw_rain(ctx);

            clock(ctx);

            ctx.fillStyle = "Black";
            data_plot(0, parseFloat(dat[19]), ctx);
            data_plot(1, parseFloat(dat[1]), ctx);
            if (parseFloat(dat[22]) > 100)
              data_plot(2, parseFloat("100"), ctx);
            else
              data_plot(2, parseFloat(dat[22]), ctx);
            if (parseFloat(dat[4]) > 100)
              data_plot(3, parseFloat("100"), ctx);
            else
              data_plot(3, parseFloat(dat[4]), ctx);
            data_plot(4, parseFloat(dat[25]), ctx);
            data_plot(5, parseFloat(dat[7]), ctx);
            data_plot(6, parseFloat(dat[10]), ctx);
            data_plot(7, parseFloat(dat[13]), ctx);
            rain_plot(parseFloat(dat[16]), parseFloat(dat[17]), ctx);

            var x = document.getElementById("cent_c");
            x.style.display = "block";

          }
        };
        xhr.open("GET", url);
        xhr.send(null);
      }

      // Start History Page
      function update_history() {
        sel = document.getElementById("duration").value;
        var url1 = "https://script.google.com/macros/s/AKfycbz8j9Kdwk7cLgs_HA_j0kPHvAvU_OL3f9zPfY4aoeh0vn5Jr17b/exec?read=" + sel;
        xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function() {
          if (xhr.readyState == 4) {
            var t_r = xhr.responseText;
            var all_dat = t_r.split(",");
            len = 30;
            var index = 0;
            var cell = 2;
            var type = 0;
            switch (sel) {
              case "hour":
                type = 1;
                mark = true;
                len = 59;
                m_len = 15;
                do {
                  myarr[0][index] = all_dat[cell]; //in temp
                  myarr[1][index] = all_dat[cell + 18]; //out temp
                  myarr[2][index] = all_dat[cell + 3]; //out hum
                  myarr[3][index] = all_dat[cell + 21]; //in hum
                  myarr[4][index] = all_dat[cell + 24]; //pres
                  myarr[5][index] = all_dat[cell + 9]; //wind
                  myarr[6][index] = all_dat[cell + 6]; //gust
                  myarr[7][index] = all_dat[cell + 15] / rain_scale; //rain mm
                  myarr[8][index] = all_dat[cell + 1]; //in low temp
                  myarr[9][index] = all_dat[cell + 19]; //out low temp
                  myarr[10][index] = all_dat[cell + 4]; //out low hum
                  myarr[11][index] = all_dat[cell + 22]; //in low hum
                  index++;
                  cell += 29;
                } while (index <= len);
                marker = all_dat[1770];
                if (parseFloat(all_dat[2 + (61 * 29)]) < parseFloat(all_dat[20 + (61 * 29)])) //temp low
                  m_m_arr[0][0] = Math.floor(all_dat[2 + (61 * 29)]);
                else
                  m_m_arr[0][0] = Math.floor(all_dat[20 + (61 * 29)]);

                if (parseFloat(all_dat[3 + (61 * 29)]) > parseFloat(all_dat[21 + (61 * 29)])) //temp high
                  m_m_arr[1][0] = Math.ceil(all_dat[3 + (61 * 29)]);
                else
                  m_m_arr[1][0] = Math.ceil(all_dat[21 + (61 * 29)]);
                if (m_m_arr[1][0] > 100) m_m_arr[1][0] = 50;

                m_m_arr[0][1] = m_m_arr[0][0];
                m_m_arr[1][1] = m_m_arr[1][0];

                if (parseFloat(all_dat[5 + (61 * 29)]) < parseFloat(all_dat[23 + (61 * 29)])) //hum low
                  m_m_arr[0][2] = Math.floor(all_dat[5 + (61 * 29)]);
                else
                  m_m_arr[0][2] = Math.floor(all_dat[23 + (61 * 29)]);
                if (m_m_arr[0][2] < 0) m_m_arr[0][2] = 0;

                if (parseFloat(all_dat[6 + (61 * 29)]) > parseFloat(all_dat[24 + (61 * 29)])) //hum high
                  m_m_arr[1][2] = Math.ceil(all_dat[6 + (61 * 29)]);
                else
                  m_m_arr[1][2] = Math.ceil(all_dat[24 + (61 * 29)]);
                if (m_m_arr[1][2] > 100) m_m_arr[1][2] = 100;

                m_m_arr[0][3] = m_m_arr[0][2];
                m_m_arr[1][3] = m_m_arr[1][2];

                m_m_arr[0][4] = Math.floor(all_dat[26 + (61 * 29)]); // pes low
                m_m_arr[1][4] = Math.ceil(all_dat[27 + (61 * 29)]); // pres high                

                m_m_arr[0][5] = 0; //wind low

                if (parseFloat(all_dat[12 + (61 * 29)]) > parseFloat(all_dat[15 + (61 * 29)])) //wind high
                  m_m_arr[1][5] = Math.ceil(all_dat[12 + (61 * 29)]);
                else
                  m_m_arr[1][5] = Math.ceil(all_dat[15 + (61 * 29)]);

                if (m_m_arr[1][5] < 2) m_m_arr[1][5] = 2;

                m_m_arr[0][6] = m_m_arr[0][5];
                m_m_arr[1][6] = m_m_arr[1][5];

                m_m_arr[0][7] = 0; //rain
                m_m_arr[1][7] = Math.ceil(all_dat[17 + (62 * 29)] / rain_scale);
                break;

              case "day":
                type = 2;
                mark = true;
                len = 24;
                m_len = 12;
                do {
                  myarr[0][index] = all_dat[cell]; //out high temp
                  myarr[1][index] = all_dat[cell + 18]; //in high temp
                  myarr[2][index] = all_dat[cell + 3]; //out high hum
                  myarr[3][index] = all_dat[cell + 21]; //in high hum
                  myarr[4][index] = all_dat[cell + 24]; //pres
                  myarr[5][index] = all_dat[cell + 6]; //wind
                  myarr[6][index] = all_dat[cell + 9]; //gust
                  myarr[7][index] = all_dat[cell + 16] / rain_scale; //rain mm
                  myarr[8][index] = all_dat[cell + 1]; //in low temp
                  myarr[9][index] = all_dat[cell + 19]; //out low temp
                  myarr[10][index] = all_dat[cell + 4]; //out low hum
                  myarr[11][index] = all_dat[cell + 22]; //in low hum
                  myarr[12][index] = all_dat[cell + 25]; //low pres
                  index++;
                  cell += 29;
                } while (index <= len);
                marker = all_dat[784];
                if (parseFloat(all_dat[2 + (27 * 29)]) < parseFloat(all_dat[20 + (27 * 29)])) //temp low
                  m_m_arr[0][0] = Math.floor(all_dat[2 + (27 * 29)]);
                else
                  m_m_arr[0][0] = Math.floor(all_dat[20 + (27 * 29)]);

                if (parseFloat(all_dat[3 + (27 * 29)]) > parseFloat(all_dat[21 + (27 * 29)])) //temp high
                  m_m_arr[1][0] = Math.ceil(all_dat[3 + (27 * 29)]);
                else
                  m_m_arr[1][0] = Math.ceil(all_dat[21 + (27 * 29)]);

                if (m_m_arr[1][0] > 100) m_m_arr[1][0] = 50;

                m_m_arr[0][1] = m_m_arr[0][0];
                m_m_arr[1][1] = m_m_arr[1][0];

                if (parseFloat(all_dat[5 + (27 * 29)]) < parseFloat(all_dat[23 + (27 * 29)])) //hum low
                  m_m_arr[0][2] = Math.floor(all_dat[5 + (27 * 29)]);
                else
                  m_m_arr[0][2] = Math.floor(all_dat[23 + (27 * 29)]);
                if (m_m_arr[0][2] < 0) m_m_arr[0][2] = 0;

                if (parseFloat(all_dat[6 + (27 * 29)]) > parseFloat(all_dat[24 + (27 * 29)])) //hum high
                  m_m_arr[1][2] = Math.ceil(all_dat[6 + (27 * 29)]);
                else
                  m_m_arr[1][2] = Math.ceil(all_dat[24 + (27 * 29)]);

                if (m_m_arr[1][2] > 100) m_m_arr[1][2] = 100;

                m_m_arr[0][3] = m_m_arr[0][2];
                m_m_arr[1][3] = m_m_arr[1][2];

                m_m_arr[0][4] = Math.floor(all_dat[26 + (27 * 29)]); // pes low
                m_m_arr[1][4] = Math.ceil(all_dat[27 + (27 * 29)]); // pres high                

                m_m_arr[0][5] = 0; //wind low

                if (parseFloat(all_dat[12 + (27 * 29)]) > parseFloat(all_dat[15 + (27 * 29)])) //wind high
                  m_m_arr[1][5] = Math.ceil(all_dat[12 + (27 * 29)]);
                else
                  m_m_arr[1][5] = Math.ceil(all_dat[15 + (27 * 29)]);
                if (m_m_arr[1][5] < 2) m_m_arr[1][5] = 2;

                m_m_arr[0][6] = m_m_arr[0][5];
                m_m_arr[1][6] = m_m_arr[1][5];

                m_m_arr[0][7] = 0; //rain
                m_m_arr[1][7] = Math.ceil(all_dat[18 + (28 * 29)] / rain_scale);
                break;

              default:
                type = 2;
                mark = false;
                var d = new Date();
                m = parseInt(d.getMonth());
                var sm = parseInt(document.getElementById("duration").selectedIndex) - 2;
                if (sm === m)
                  len = parseInt(d.getDate()) - 2;
                else {
                  if ((sm === 3) || (sm === 5) || (sm === 8) || (sm === 10)) len = 29;
                  else len = 30;
                  if (sm === 1)
                    if (d.getFullYear() % 4 === 0) len = 28;
                    else len = 27;
                }
                do {
                  myarr[0][index] = all_dat[cell]; //out high temp
                  myarr[1][index] = all_dat[cell + 18]; //in high temp
                  myarr[2][index] = all_dat[cell + 3]; //out high hum
                  myarr[3][index] = all_dat[cell + 21]; //in high hum
                  myarr[4][index] = all_dat[cell + 24]; //pres
                  myarr[5][index] = all_dat[cell + 6]; //wind
                  myarr[6][index] = all_dat[cell + 9]; //gust
                  myarr[7][index] = all_dat[cell + 16] / rain_scale; //rain
                  myarr[8][index] = all_dat[cell + 1]; //in low temp
                  myarr[9][index] = all_dat[cell + 19]; //out low temp
                  myarr[10][index] = all_dat[cell + 4]; //out low hum
                  myarr[11][index] = all_dat[cell + 22]; //in low hum
                  myarr[12][index] = all_dat[cell + 25]; //low pres
                  index++;
                  cell += 29;
                } while (index <= len);
                if (parseFloat(all_dat[2 + (33 * 29)]) < parseFloat(all_dat[20 + (33 * 29)])) //temp low
                  m_m_arr[0][0] = Math.floor(all_dat[2 + (33 * 29)]);
                else
                  m_m_arr[0][0] = Math.floor(all_dat[20 + (33 * 29)]);

                if (parseFloat(all_dat[3 + (33 * 29)]) > parseFloat(all_dat[21 + (33 * 29)])) //temp high
                  m_m_arr[1][0] = Math.ceil(all_dat[3 + (33 * 29)]);
                else
                  m_m_arr[1][0] = Math.ceil(all_dat[21 + (33 * 29)]);
                if (m_m_arr[1][0] > 100) m_m_arr[1][0] = 50;

                m_m_arr[0][1] = m_m_arr[0][0];
                m_m_arr[1][1] = m_m_arr[1][0];


                if (parseFloat(all_dat[5 + (33 * 29)]) < parseFloat(all_dat[23 + (33 * 29)])) //hum low
                  m_m_arr[0][2] = Math.floor(all_dat[5 + (33 * 29)]);
                else
                  m_m_arr[0][2] = Math.floor(all_dat[23 + (33 * 29)]);
                if (m_m_arr[0][2] < 0) m_m_arr[0][2] = 0;

                if (parseFloat(all_dat[6 + (33 * 29)]) > parseFloat(all_dat[24 + (33 * 29)])) //hum high
                  m_m_arr[1][2] = Math.ceil(all_dat[6 + (33 * 29)]);
                else
                  m_m_arr[1][2] = Math.ceil(all_dat[24 + (33 * 29)]);
                if (m_m_arr[1][2] > 100) m_m_arr[1][2] = 100;

                m_m_arr[0][3] = m_m_arr[0][2];
                m_m_arr[1][3] = m_m_arr[1][2];

                m_m_arr[0][4] = Math.floor(all_dat[26 + (33 * 29)]); // pes low
                m_m_arr[1][4] = Math.ceil(all_dat[27 + (33 * 29)]); // pres high                

                m_m_arr[0][5] = 0; //wind low

                if (parseFloat(all_dat[12 + (33 * 29)]) > parseFloat(all_dat[15 + (33 * 29)])) //wind high
                  m_m_arr[1][5] = Math.ceil(all_dat[12 + (33 * 29)]);
                else
                  m_m_arr[1][5] = Math.ceil(all_dat[15 + (33 * 29)]);
                if (m_m_arr[1][5] < 2) m_m_arr[1][5] = 2;

                m_m_arr[0][6] = m_m_arr[0][5];
                m_m_arr[1][6] = m_m_arr[1][5];

                m_m_arr[0][7] = 0; //rain
                m_m_arr[1][7] = Math.ceil(all_dat[18 + (33 * 29)] / rain_scale);

                m_len = Math.ceil((len + 1) / 2);
                break;
            }
            var count = 7;
            do {
              if (m_m_arr[1][count] - m_m_arr[0][count] < 1) m_m_arr[1][count] = m_m_arr[0][count] + 1;
              count--;
            } while (count > 0);
            build_history(type, len);
          }
        };
        xhr.open("GET", url1);
        xhr.send(null);
      }

      function build_history(data_valid, len) {
        var temp = new Array();
        var min = 0;
        var max = 1;
        var ticks = 30;
        var points = 60;
        var first = 1;
        if (data_valid > 0) {
          switch (sel) {
            case "hour":
              ticks = 15;
              points = 60;
              first = 0;
              break;
            case "day":
              ticks = 12;
              points = 23;
              break;
            default:
              ticks = m_len;
              points = len;
              break;
          }
        }
        var plots = 0;
        var range = 0;
        var d_set;
        switch (H_offset) {
          case 0:
            d_set = 0;
            break;
          case 1:
            d_set = 2;
            break;
          case 2:
            d_set = 4;
            break;
          case 3:
            d_set = 5;
            break;
          case 4:
            d_set = 7;
            break;
        }
        switch (data_valid) {
          case 0:
            do {
              min = 0;
              max = 2;
              range = 2
              draw_graph(plots, range, min, ticks, points, 0, 0);
              plots++;
            } while (plots < 5);
            break;
          case 1:
            do {
              min = m_m_arr[0][d_set];
              max = m_m_arr[1][d_set];
              range = max - min;
              if (plots === 0) {
                range = Math.ceil(range / 8) * 8;
                if (max < (range / 2))
                  range = Math.ceil(range / 2);
                if (max < (range / 2))
                  range = Math.ceil(range / 2);
              } else {
                range = Math.ceil(range / 4) * 4;
                if (max < (range / 2))
                  range = Math.ceil(range / 2);
              }
              if ((d_set === 2) || (d_set === 3)) {
                if (range + min > 100) min = 100 - range;
              }
              draw_graph(plots, range, min, ticks, points, d_set, first);
              temp = new Array();
              temp = myarr[d_set];
              fill_chart(0, plots, temp, range, min, points, d_set);
              if ((d_set === 0) || (d_set === 2) || (d_set === 5)) {
                d_set++;
                temp = new Array();
                temp = myarr[d_set];
                fill_chart(1, plots, temp, range, min, points, d_set);
              }
              d_set++;
              if (d_set === 8) d_set = 0;
              plots++;
            } while (plots < 5);
            break;
          case 2:
            do {
              min = m_m_arr[0][d_set];
              max = m_m_arr[1][d_set];
              range = max - min;
              if (plots === 0) {
                range = Math.ceil(range / 8) * 8;
                if (max < (range / 2))
                  range = Math.ceil(range / 2);
                if (max < (range / 2))
                  range = Math.ceil(range / 2);
              } else {
                range = Math.ceil(range / 4) * 4;
                if (max < (range / 2))
                  range = Math.ceil(range / 2);
              }
              if ((d_set === 2) || (d_set === 3)) {
                if (range + min > 100) min = 100 - range;
              }
              draw_graph(plots, range, min, ticks, points, d_set, first);
              temp = new Array();
              temp = myarr[d_set];
              if ((d_set === 4) || (d_set === 7)) {
                fill_chart(0, plots, temp, range, min, points, d_set);
              }
              if (d_set === 5) {
                fill_chart(0, plots, temp, range, min, points, d_set);
                d_set++;
                temp = new Array();
                temp = myarr[d_set];
                fill_chart(1, plots, temp, range, min, points, d_set);
              }

              if ((d_set === 0) || (d_set === 2)) {
                fill_chart(2, plots, temp, range, min, points, d_set);
                temp = new Array();
                temp = myarr[d_set + 8];
                fill_chart(4, plots, temp, range, min, points, d_set + 8);
              }
              if ((d_set === 0) || (d_set === 2)) {
                d_set++;
                temp = new Array();
                temp = myarr[d_set];
                fill_chart(3, plots, temp, range, min, points, d_set);
                if ((d_set === 1) || (d_set === 3)) {
                  temp = new Array();
                  temp = myarr[d_set + 8];
                  fill_chart(5, plots, temp, range, min, points, d_set + 8);
                }
              }
              d_set++;
              if (d_set === 8) d_set = 0;
              plots++;
            } while (plots < 5);
            break;
        }
        myMsg.close();
        var x = document.getElementById("cent_c");
        x.style.display = "none";
        x = document.getElementById("canvas_area_1");
        x.style.display = "block";
        x = document.getElementById("about");
        x.style.display = "none";
      }

      function draw_graph(num, range, min, ticks, points, t_index, first) {
        var sm = parseInt(document.getElementById("duration").selectedIndex);
        var ctx = chart[num];
        ctx.font = "10px Arial";
        var y_inc = range / 4;
        var x = 60;
        var y = 30;
        var w = 300;
        var h = 100;
        var ys = 100 / 4;
        var steps = 4;
        var x_step = Math.round(points / ticks);

        ctx.fillStyle = "White";

        if (num === 0) {
          w = 700;
          h = 600;
          steps = 8;
          y_inc = range / 8;
          ys = h / 8;
          ctx.fillRect(0, 0, 800, 780);
        } else
          ctx.fillRect(0, 0, 400, 170);
        ctx.fillStyle = "black";
        ctx.beginPath();
        ctx.lineWidth = 1;
        ctx.strokeStyle = "grey";
        ctx.rect(x, y, w, h);
        ctx.stroke();

        ctx.textAlign = "center";
        var xl = x;
        var xs = (w / (points)) * x_step;
        var c_b = y + h;
        var i = first;
        ctx.font = "11px Arial";
        ctx.beginPath();
        ctx.fillText(i, xl, y + h + 14);
        while (xl <= (w + x)) {
          xl += xs;
          if (w + x - 10 <= xl) break;
          ctx.moveTo(xl, y);
          ctx.lineTo(xl, c_b);
          i += x_step;
          ctx.fillText(i, xl, y + h + 14);
        };
        ctx.fillText(points + first, w + x, y + h + 14);
        ctx.stroke();
        var yl = y;
        c_b = x + w;
        ctx.beginPath();
        i = min + range;
        var step = range / steps;
        while (yl <= (h + y) - 1) {
          ctx.fillText(i, 45, yl + 5);
          yl += ys;
          ctx.moveTo(x, yl);
          ctx.lineTo(c_b, yl);
          i -= step;
        };
        ctx.fillText(i, 45, yl + 5);
        ctx.stroke();
        ctx.font = "13px Arial";
        if (num === 0)
          ctx.fillText(axis_y_label[t_index], 25, y + (h / 2) - 20);
        else
          ctx.fillText(axis_y_label[t_index], 18, y + (h / 2));
        ctx.fillText(titles[t_index], x + (w / 2), 17);
        ctx.fillText(axis_x_label[sm], x + (w / 2), yl + 28);
        ctx.font = "11px Arial";

        ctx.strokeStyle = "black";
        ctx.fillStyle = "black";
      }

      function fill_chart(col, c_num, p_data, range, min, p, type) {
        var ctx = chart[c_num];
        var x = 60;
        var y = 30;
        var w = 300;
        var h = 100;
        if (c_num === 0) {
          w = 700;
          h = 600;
        };
        var r_label = x + w - 170;
        if (col === 0) {
          ctx.fillText(plot[type], 130, 17);
          ctx.strokeStyle = col1;
          ctx.fillStyle = col1;
          ctx.fillRect(90, 7, 15, 10);
        }
        if (col === 1) {
          ctx.fillText(plot[type], r_label + 130, 17);
          ctx.strokeStyle = col2;
          ctx.fillStyle = col2;
          ctx.fillRect(r_label + 90, 7, 15, 10);
          //    ctx.fillRect(110, 7, 15, 10);
        }
        if (col === 2) {
          ctx.fillText(plot[type], 80, 17);
          ctx.strokeStyle = col3;
          ctx.fillStyle = col3;
          ctx.fillRect(110, 7, 15, 10);
        }
        if (col === 3) {
          ctx.fillText(plot[type], r_label + 95, 17);
          ctx.strokeStyle = col4;
          ctx.fillStyle = col4;
          ctx.fillRect(r_label + 120, 7, 15, 10);
        }
        if (col === 4) {
          ctx.fillText(plot[type], 150, 17);
          ctx.strokeStyle = col1;
          ctx.fillStyle = col1;
          ctx.fillRect(40, 7, 15, 10);
        }
        if (col === 5) {
          ctx.fillText(plot[type], r_label + 155, 17);
          ctx.strokeStyle = col2;
          ctx.fillStyle = col2;
          ctx.fillRect(r_label + 60, 7, 15, 10);
        }
        var y_inc = h / range;
        var i = min + range;
        var s = 0;
        var y1 = 0;
        var xs = w / p;
        var xm = x + (xs * marker);
        var hm = y + h;
        if (i < p_data[0]) p_data[0] = i;
        y1 = y + (y_inc * (i - p_data[0]));
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(x, y1);
        do {
          s++;
          x += xs;
          if (i < p_data[s]) p_data[s] = i;
          y1 = y + (y_inc * (i - p_data[s]));
          if (y1 > (y + h))
            ctx.moveTo(x, y + h);
          else
            ctx.lineTo(x, y1);
        } while (s < p);
        ctx.stroke();
        if (mark) {
          ctx.beginPath();
          ctx.fillStyle = "black";
          ctx.moveTo(xm - 5, hm);
          ctx.lineTo(xm, hm - 7);
          ctx.lineTo(xm + 5, hm);
          ctx.lineTo(xm - 5, hm);
          ctx.fill();
        }
        ctx.strokeStyle = "black";
        ctx.fillStyle = "black";
      }

      function move_history() {
        var min;
        var max;
        var temp;
        var points;
        var range;
        var h_c = 0;
        var first = 1;
        var fun = 0;
        switch (sel) {
          case "hour":
            points = 60;
            ticks = 15;
            first = 0;
            fun = 1;
            break;
          case "day":
            points = 23;
            ticks = 12;
            break;
          default:
            points = len;
            ticks = m_len;
            break;
        }

        switch (H_offset) {
          case 0:
            h_c = 0;
            break;
          case 1:
            h_c = 2;
            break;
          case 2:
            h_c = 4;
            break;
          case 3:
            h_c = 5;
            break;
          case 4:
            h_c = 7;
            break;
        }
        var plots = 0;
        if (fun === 1) {
          do {
            min = m_m_arr[0][h_c];
            max = m_m_arr[1][h_c];
            range = max - min;
            if (plots === 0) {
              range = Math.ceil(range / 8) * 8;
              if (max < (range / 2))
                range = Math.ceil(range / 2);
              if (max < (range / 2))
                range = Math.ceil(range / 2);
            } else {
              range = Math.ceil(range / 4) * 4;
              if (max < (range / 2))
                range = Math.ceil(range / 2);
            }
            if ((h_c === 2) || (h_c === 3)) {
              if (range + min > 100) min = 100 - range;
            }
            draw_graph(plots, range, min, ticks, points, h_c, first);
            temp = new Array();
            temp = myarr[h_c];
            if (h_c === 4) {
              fill_chart(0, plots, temp, range, min, points, h_c);
            }

            if (h_c === 7) {
              fill_chart(0, plots, temp, range, min, points, h_c);
            }

            if ((h_c === 0) || (h_c === 2) || (h_c === 5)) {
              h_c++;
              temp = new Array();
              temp = myarr[h_c];
              fill_chart(1, plots, temp, range, min, points, h_c);
            }
            h_c++;
            if (h_c === 8) h_c = 0;
            plots++;

          } while (plots < 5)
        } else {
          do {
            min = m_m_arr[0][h_c];
            max = m_m_arr[1][h_c];
            range = max - min;
            if (plots === 0) {
              range = Math.ceil(range / 8) * 8;
              if (max < (range / 2))
                range = Math.ceil(range / 2);
              if (max < (range / 2))
                range = Math.ceil(range / 2);
            } else {
              range = Math.ceil(range / 4) * 4;
              if (max < (range / 2))
                range = Math.ceil(range / 2);
            }

            if ((h_c === 2) || (h_c === 3)) {
              if (range + min > 100) min = 100 - range;
            }
            draw_graph(plots, range, min, ticks, points, h_c, first);
            temp = new Array();
            temp = myarr[h_c];
            if (h_c === 4) {
              fill_chart(0, plots, temp, range, min, points, h_c);
            }

            if (h_c === 7) {
              fill_chart(0, plots, temp, range, min, points, h_c);
            }

            if (h_c === 5) {
              fill_chart(0, plots, temp, range, min, points, h_c);
              h_c++;
              temp = new Array();
              temp = myarr[h_c];
              fill_chart(1, plots, temp, range, min, points, h_c);
            }

            if ((h_c === 0) || (h_c === 2)) {
              fill_chart(2, plots, temp, range, min, points, h_c);
              temp = new Array();
              temp = myarr[h_c + 8];
              fill_chart(4, plots, temp, range, min, points, h_c + 8);
            }
            if ((h_c === 0) || (h_c === 2)) {
              h_c++;
              temp = new Array();
              temp = myarr[h_c];
              fill_chart(3, plots, temp, range, min, points, h_c);
              if ((h_c === 1) || (h_c === 3)) {
                temp = new Array();
                temp = myarr[h_c + 8];
                fill_chart(5, plots, temp, range, min, points, h_c + 8);
              }
            }
            h_c++;
            if (h_c === 8) h_c = 0;
            plots++;

          } while (plots < 5)

        }

      }

      function WaitDownload() {
        wLeft = window.screenLeft ? window.screenLeft : window.screenX;
        wTop = window.screenTop ? window.screenTop : window.screenY;
        var left = wLeft + (window.innerWidth / 2) - (100);
        var top = wTop + (window.innerHeight / 2) - (50);
        myMsg = window.open("", "MsgWindow", 'toolbar=no, personalbar=no, directories=no, status=no, menubar=no, scrollbars=no,resizable=no,copyhistory=no, width= 350, height= 180 , top=' + top + ', left=' + left);
        myMsg.document.write("<h1>Downloading Data</h1>");
        myMsg.document.write("<h1>Please Wait</h1>");
      }

      function make_array() {
        myarr = new Array();
        myarr.push([]);
        myarr.push([]);
        myarr.push([]);
        myarr.push([]);
        myarr.push([]);
        myarr.push([]);
        myarr.push([]);
        myarr.push([]);
        myarr.push([]);
        myarr.push([]);
        myarr.push([]);
        myarr.push([]);
        myarr.push([]);
        m_m_arr = new Array();
        m_m_arr.push([]);
        m_m_arr.push([]);
      }

      sort_update = function() {
        if (active_window == 0)
          update_fields();
        if (active_window == 1) {
          update_history();
        }
      }
      document.getElementById("current").onclick = function myFunction() {
        document.getElementById("duration").style.visibility = 'hidden';
        document.getElementById("ld").style.visibility = 'hidden';
        var x = document.getElementById("cent_c");
        x.style.display = "block";
        x = document.getElementById("canvas_area_1");
        x.style.display = "none";
        x = document.getElementById("about");
        x.style.display = "none";
        active_window = 0;
        sort_update();
        return false;
      }

      document.getElementById("history").onclick = function myFunction() {
        document.getElementById("duration").style.visibility = 'visible';
        document.getElementById("ld").style.visibility = 'visible';
        var x = document.getElementById("cent_c");
        x.style.display = "none";
        x = document.getElementById("canvas_area_1");
        x.style.display = "block";
        x = document.getElementById("about");
        x.style.display = "none";
        WaitDownload();
        active_window = 1;
        sort_update();
        return false;
      }

      document.getElementById("about1").onclick = function myFunction() {
        document.getElementById("duration").style.visibility = 'hidden';
        document.getElementById("ld").style.visibility = 'hidden';
        var x = document.getElementById("cent_c");
        x.style.display = "none";
        x = document.getElementById("canvas_area_1");
        x.style.display = "none";
        x = document.getElementById("about");
        x.style.display = "block";
        return false;
      }

      function canvas_b_click() {
        H_offset += 1;
        H_offset = H_offset % 5;
        move_history();
      }

      function canvas_c_click() {
        H_offset += 2;
        H_offset = H_offset % 5;
        move_history();
      }

      function canvas_d_click() {
        H_offset += 3;
        H_offset = H_offset % 5;
        move_history();
      }

      function canvas_e_click() {
        H_offset += 4;
        H_offset = H_offset % 5;
        move_history();
      }

      var x = document.getElementById("cent_c");
      x.style.display = "block";
      x = document.getElementById("canvas_area_1");
      x.style.display = "none";
      x = document.getElementById("about");
      x.style.display = "none";
      document.getElementById("duration").style.visibility = 'hidden';
      document.getElementById("ld").style.visibility = 'hidden';
      var myVar = setInterval(sort_update, 30000);
      active_window = 0;
      make_array();
      sort_update();
    }
  </script>
</head>

<body class="htmlNoPages">
  <div class="sidenav">
    <a href="#" id="current">Current </a>
    <a href="#" id="history">History</a>
    <a href="#" id="about1">About</a>
    <div>
      <p id="ld" left="20px"><font color="#818181">History</font>
      </p>
    </div>
    <select name="optionList" id="duration" height="30" width="100" margin="auto" onchange="handleSelect()">
      <option value="hour">Hour</option>
      <option value="day">Day</option>
      <option value="Jan">January</option>
      <option value="Feb">Febuary</option>
      <option value="Mar">March</option>
      <option value="Apr">April</option>
      <option value="May">May</option>
      <option value="Jun">June</option>
      <option value="Jul">July</option>
      <option value="Aug">August</option>
      <option value="Sep">September</option>
      <option value="Oct">October</option>
      <option value="Nov">November</option>
      <option value="Dec">December</option>
    </select>
  </div>
  <div class="data" id="Data">
    <div class="graph">
      <div class="cent_c" id="cent_c">
        <canvas id="canvas" height="780" width="1000"></canvas>
      </div>
      <div class="cent" id="canvas_area_1" height="750" width="1180">
        <div class="column">
          <div class="row">
            <canvas id="canvas_b" width="400" height="170"></canvas>
          </div>
          <div class="row">
            <canvas id="canvas_c" width="400" height="170"></canvas>
          </div>
          <div class="row">
            <canvas id="canvas_d" width="400" height="170"></canvas>
          </div>
          <div class="row">
            <canvas id="canvas_e" width="400" height="170"></canvas>
          </div>
        </div>
        <div class="column_1">
          <canvas id="canvas_a" width="780" height="680"></canvas>
        </div>
      </div>
    </div>
    <div class="about" id="about">
      <div class="cent">
        <h3>Weather Station Operation</h3>
        <h4>Temperature </h4>
        <p>Sensor AM2320</p>
        <h4>Humidity </h4>
        <p>Sensor AM2320</p>
        <p></p>
        <h4>Air Pressure</h4>
        <p>Sensor BMP180</p>
        <p></p>
        <h4>Rain Fall</h4>
        <p>Count number of drips from calibrated Tube</p>
        <p></p>
        <h4>Wind Speed and Direction</h4>
        <p>Utrasonic Sensors @ N, S, E &amp; W</p>
        <p>Pulse Sensors N-S, S-N</p>
        <p>Measure Time of Flight each way to calculte N-S vector</p>
        <p>Pulse Sensors E-W, W-E</p>
        <p>Measure Time of Flight each way to calculte E-W vector</p>
        <p>Calculate Speed of Sound using Temperature and Humidity</p>
        <p>From above calculate Wind Speed and Bearing using Trig</p>
      </div>
    </div>
  </div>


</body></html>
